on: [push]

jobs:
  container-scan-to-sarif_job:
    runs-on: ubuntu-latest
    name: A job to convert Container Scan reports to SARIF
    steps:
      - uses: actions/checkout@v2

      - name: Scan sample image with Azure Container Scan
        id: container-image-scan
        uses: Azure/container-scan@v0.1
        with:
          image-name: debian:11

      - name: container-scan-to-sarif action step
        id: container-scan-to-sarif-step
        if: ${{ always() }}
        uses: ./
        with:
          converter-version: 0.2.2
          input-file: ${{ steps.container-image-scan.outputs.scan-report-path }}

      - run: cat "${{ steps.container-scan-to-sarif-step.outputs.sarif-report-path }}"

      - name: Upload SARIF reports to GitHub Security tab
        uses: github/codeql-action/upload-sarif@v1
        if: ${{ always() }}
        with:
          sarif_file: ${{ steps.container-scan-to-sarif-step.outputs.sarif-report-path }}
